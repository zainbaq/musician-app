"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var e=function(t,e){var n=0;return t.reduce(function(t,e){return t.set(e,n),n+=e.length,t},new Float32Array(e))},n=function(t,e,n){n.split("").map(function(t,e){return n.charCodeAt(e)}).forEach(function(n,r){t.setUint8(e+r,n)})},r={leftChan:[],rightChan:[],recordingLength:0};exports.Microphone=function(a){var o,i,c,u,s=t({},r),f=!(!a||!a.isMono),h=f?1:2,l=a&&a.sampleRate||44100,d={nbChannels:h,sampleRate:l,bufferSize:2048,byteRate:l*h*2},g=function(){return u};return{start:function(){try{return Promise.resolve(navigator.mediaDevices.getUserMedia({audio:!0,video:!1})).then(function(t){o=t;var e=new AudioContext,n=e.createGain();i=e.createMediaStreamSource(o),(c=e.createScriptProcessor(d.bufferSize,2,2)).onaudioprocess=function(t){var e=new Float32Array(t.inputBuffer.getChannelData(0));s.leftChan.push(e),s.rightChan.push(new Float32Array(t.inputBuffer.getChannelData(1))),s.recordingLength+=d.bufferSize,a&&a.onData&&a.onData(e)},i.connect(n),i.connect(c),c.connect(e.destination)})}catch(t){return Promise.reject(t)}},stop:function(){o&&o.getTracks().forEach(function(t){return t.stop()}),c&&c.disconnect(),i&&i.disconnect();var t,r=e(s.leftChan,s.recordingLength),a=e(s.rightChan,s.recordingLength),h=function(t,e,n){if(44100===n)return t;for(var r=44100/n,a=Math.round(t.length/r),o=new Float32Array(a),i=0,c=0;i<o.length;){for(var u=Math.round((i+1)*r),s=0,f=0,h=c;h<u&&h<t.length;h++)s+=t[h],f++;o[i]=s/f,i++,c=u}return o}(f?r:(t=r).reduce(function(e,n,r){var a=2*r;return e[a]=t[r],e[a+1]=t[r],e},new Float32Array(t.length+a.length)),0,d.sampleRate);u=function(t){var e=new ArrayBuffer(44+2*t.length),r=new DataView(e);n(r,0,"RIFF"),r.setUint32(4,44+2*t.length,!0),n(r,8,"WAVE"),n(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,d.nbChannels,!0),r.setUint32(24,d.sampleRate,!0),r.setUint32(28,d.byteRate,!0),r.setUint16(32,4,!0),r.setUint16(34,16,!0),n(r,36,"data"),r.setUint32(40,2*t.length,!0);for(var a=0;a<t.length;a++)r.setInt16(44+2*a,32767*t[a],!0);return new Blob([r],{type:"audio/wav"})}(h)},reset:function(){s=t({},r)},download:function(){var t=g();if(t&&window&&document&&URL){var e=URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.href=e,n.download=(new Date).toISOString()+".wav",n.click(),window.URL.revokeObjectURL(e)}},getBlob:g}};
//# sourceMappingURL=microphone-js.cjs.production.min.js.map
